<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Flick Picker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  </head>
  <body class="p-4">
    <div class="container">
      <h1>Flick Picker — Demo</h1>
      <p>Create a user, add watched movies by TMDB ID, then get recommendations.</p>

      <div class="mb-3">
        <label class="form-label">User name</label>
        <input id="username" class="form-control" placeholder="Your name">
        <button id="createUser" class="btn btn-primary mt-2">Create User</button>
        <div id="userInfo" class="mt-2"></div>
      </div>

      <div class="mb-3">
        <label class="form-label">Add watched (TMDB ID)</label>
        <input id="tmdbid" class="form-control" placeholder="e.g. 603 (The Matrix)">
        <button id="addWatched" class="btn btn-secondary mt-2">Add Watched</button>
      </div>

      <div class="mb-3">
        <button id="getRecs" class="btn btn-success">Get Recommendations</button>
      </div>

      <div id="recs" class="mt-3"></div>
    </div>

    <script>
      let currentUser = null;
      document.getElementById('createUser').onclick = async () => {
        const name = document.getElementById('username').value;
        const res = await fetch('/users', {method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name})});
        const data = await res.json();
        currentUser = data;
        document.getElementById('userInfo').innerText = `Created user ${data.name} (id=${data.id})`;
      }

      document.getElementById('addWatched').onclick = async () => {
        if(!currentUser){ alert('Create or set a user first'); return; }
        const tmdb = parseInt(document.getElementById('tmdbid').value);
        const res = await fetch(`/users/${currentUser.id}/history`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({tmdb_id: tmdb})});
        const data = await res.json();
        alert('Added watched: ' + JSON.stringify(data));
      }

      document.getElementById('getRecs').onclick = async () => {
        if(!currentUser){ alert('Create or set a user first'); return; }
        const res = await fetch(`/users/${currentUser.id}/recommend`);
        const data = await res.json();
        const el = document.getElementById('recs');
        el.innerHTML = '<h3>Recommendations</h3>' + (data.length ? ('<ul>' + data.map(d=>`<li>${d.title} (TMDB ${d.tmdb_id}) — ${d.score.toFixed(3)}</li>`).join('') + '</ul>') : '<p>No recs yet</p>');
      }
    </script>
  </body>
</html>
